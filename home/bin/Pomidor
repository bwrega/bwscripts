#!/bin/fish
set nrPomidora $argv[1]
if [ -z "$nrPomidora" ]
	echo "Użycie: Pomidor nr_pomidora" 1>&2
	exit 1
end

set sleepTick 10 #sekund

echo Wciśnij ENTER żeby zrobić pauzę
echo

for minuta in (seq 25 -1 1)
	printf "Zostało %2d minut " $minuta
	for i in (seq 6)
		set startTick (date +%s.%N)
		if bash -c "read -t $sleepTick"
			set timeLeft (math (date +%s.%N) - $startTick)
			echo Pauza!
			echo Wciśnij Enter żeby wznowić POMIDORA
			bash -c "read"
			echo Wznawiam...
			sleep $timeLeft
		end
		echo -n +
	end
	echo
end

echo
echo Koniec pomidora nr $nrPomidora

beep -r 2 -D 100

if [ (math "$nrPomidora"%4) = 0 ]
	echo 'Zrób sobie dłuższą przerwę!'
	for f in (seq 100 100 3000) ; echo "-f $f -l 17 -n " ; end | xargs beep
end
